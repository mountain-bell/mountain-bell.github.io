"use strict";var DomTrigger=(()=>{var w=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var z=(e,t)=>{for(var o in t)w(e,o,{get:t[o],enumerable:!0})},J=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of X(t))!j.call(e,r)&&r!==o&&w(e,r,{get:()=>t[r],enumerable:!(n=G(t,r))||n.enumerable});return e};var q=e=>J(w({},"__esModule",{value:!0}),e);var ue={};z(ue,{default:()=>ce});function d(e){return/^[a-z][a-z0-9]*(?:-[a-z0-9]+)*$/.test(e)}function f(e,t){let o=[];return e.classList.forEach(n=>{if(!n.startsWith(t))return;let r=n.slice(t.length);d(r)&&o.push(r)}),o}var h=new WeakMap,p="uncache";function P(e,t){let o=`data-${p}-${t}`,n=!e.hasAttribute(o);if(n){let s=h.get(e)?.get(t);if(s)return s}let r=n?`data-${t}`:o,a=e.getAttribute(r);if(!a)return{};let u;try{u=JSON.parse(a)}catch{throw new Error(`[DomTrigger] Invalid JSON in ${r}: ${a}`)}if(n){let c=h.get(e)??new Map;c.set(t,u),h.set(e,c)}return u}function I(e,t){let o=e.boundingClientRect,n=o.top+o.height/2,r=window.innerHeight/2;return Math.abs(n-r)<=t}var E=new Map,l={set(e,t){E.set(e,t)},get(e){return E.get(e)},delete(e){E.delete(e)},clear(){E.clear()}};var i="js-",$=`${i}load-`,T=`${i}viewin-`,R=`${i}viewout-`,M="view-center",N="view-ratio",K=[`[class^="${T}"]`,`[class*=" ${T}"]`,`[class^="${R}"]`,`[class*=" ${R}"]`].join(", "),m=null,S=new WeakSet,v=new WeakMap,y={click:`${i}click-`,submit:`${i}submit-`,change:`${i}change-`,input:`${i}input-`,focusin:`${i}focusin-`,focusout:`${i}focusout-`,pointerdown:`${i}pointerdown-`,pointermove:`${i}pointermove-`,pointerup:`${i}pointerup-`,pointercancel:`${i}pointercancel-`,transitionend:`${i}transitionend-`,animationend:`${i}animationend-`,visibilitychange:`${i}visibilitychange-`,pageshow:`${i}pageshow-`,pagehide:`${i}pagehide-`,online:`${i}online-`,offline:`${i}offline-`,copy:`${i}copy-`,paste:`${i}paste-`,keydown:`${i}keydown-`,keyup:`${i}keyup-`,mouseover:`${i}mouseover-`,mouseout:`${i}mouseout-`},O=new Set(["pageshow","pagehide","online","offline"]),B=new Set(["visibilitychange",...O]),D=Object.keys(y),V="prevent-default",L="stop-propagation",Q=D.map(e=>`${e}-${V}`),Y=D.map(e=>`${e}-${L}`),k=new Set,A=!1,Z=new Set([M,N,...Q,...Y,p]),ee=`${p}-`;function te(e,t){if(!d(e))throw new Error(`[DomTrigger.use] Invalid trigger name: "${e}". Use kebab-case.`);if(Z.has(e)||e.startsWith(ee))throw new Error(`[DomTrigger.use] Reserved trigger name: "${e}".`);l.set(e,t)}async function ne(e,t){if(!d(e))throw new Error(`[DomTrigger.run] Invalid trigger name: "${e}". Use kebab-case.`);let o=l.get(e);o&&await o(t||{})}async function g(e,t,o){if(!d(e))throw new Error(`[DomTrigger.invoke] Invalid trigger name: "${e}". Use kebab-case.`);let n=l.get(e);if(!n)return;let r=P(t,e);await n({el:t,data:r,ctx:{name:e,event:o}})}async function C(){if(typeof document>"u")return;let e=Array.from(document.querySelectorAll(`[class^="${$}"], [class*=" ${$}"]`));for(let t of e){let o=f(t,$);for(let n of o)try{await g(n,t)}catch(r){console.error(`[DomTrigger.invokeLoad] Failed to invoke "${n}":`,t,r)}}}async function F(){if(typeof document>"u")return;let e=y.pageshow;if(!e)return;let t=document.body,o=f(t,e);for(let n of o)try{await g(n,t)}catch(r){console.error(`[DomTrigger.invokeShow] Failed to invoke "${n}":`,t,r)}}function oe(e){if(typeof document>"u"||k.has(e))return;k.add(e);let t=y[e];if(!t)return;(O.has(e)?window:document).addEventListener(e,n=>{if(e==="pointermove"&&!A)return;(e==="pointerup"||e==="pointercancel")&&(A=!1);let r=B.has(e)?document.body:n.target instanceof Element?n.target:null;if(!r)return;let a=r.closest(`[class^="${t}"], [class*=" ${t}"]`);if(!a)return;let u=a.getAttribute(`data-${e}-${V}`);u!==null&&u!=="false"&&n.preventDefault();let s=a.getAttribute(`data-${e}-${L}`);s!==null&&s!=="false"&&n.stopPropagation(),e==="pointerdown"&&(A=!0);let _=f(a,t);for(let U of _)g(U,a,n)})}function W(){for(let e of D)oe(e)}function H(){if(typeof document>"u"||typeof IntersectionObserver>"u")return;m||(m=new IntersectionObserver(t=>{for(let o of t){if(!(o.target instanceof Element))continue;let n=o.target,r=!1,a=n.getAttribute(`data-${M}`);if(a!==null){let c=a?parseInt(a,10):20,s=c>=0?c:20;r=I(o,s)}else{let c=n.getAttribute(`data-${N}`),s=c?parseFloat(c):0,b=s>=0&&s<=1?s:0;r=o.intersectionRatio>=b}let u=v.get(n);if(o.isIntersecting&&r){if(u==="in")continue;let c=f(n,T);for(let s of c)g(s,n);v.set(n,"in")}else{if(u!=="in")continue;let c=f(n,R);for(let s of c)g(s,n);v.set(n,"out")}}},{threshold:Array.from({length:11},(t,o)=>o/10)})),document.querySelectorAll(K).forEach(t=>{m&&!S.has(t)&&(m.observe(t),S.add(t))})}function re(e){l.delete(e)}function ie(){l.clear()}async function x(){await C(),await F(),W(),H()}async function se(){if(!(typeof document>"u")){document.readyState==="loading"&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",()=>e(),{once:!0})});try{await x()}catch(e){console.error("[DomTrigger.setupOnReady] Failed to setup:",e)}}}var ae={use:te,run:ne,invoke:g,invokeLoad:C,invokeShow:F,listen:W,observeView:H,unuse:re,clear:ie,setup:x,setupOnReady:se},ce=ae;return q(ue);})();
DomTrigger = DomTrigger.default || DomTrigger;
//# sourceMappingURL=dom-trigger.js.map
