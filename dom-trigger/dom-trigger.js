"use strict";var DomTrigger=(()=>{var h=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var G=(e,t)=>{for(var i in t)h(e,i,{get:t[i],enumerable:!0})},X=(e,t,i,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of W(t))!U.call(e,n)&&n!==i&&h(e,n,{get:()=>t[n],enumerable:!(o=H(t,n))||o.enumerable});return e};var j=e=>X(h({},"__esModule",{value:!0}),e);var re={};G(re,{default:()=>oe});function m(e){return/^[a-z][a-z0-9]*(?:-[a-z0-9]+)*$/.test(e)}function g(e,t){let i=[];return e.classList.forEach(o=>{if(!o.startsWith(t))return;let n=o.slice(t.length);m(n)&&i.push(n)}),i}var y=new WeakMap;function P(e,t){let i=`data-uncache-${t}`,o=!e.hasAttribute(i);if(o){let l=y.get(e)?.get(t);if(l)return l}let n=o?`data-${t}`:i,s=e.getAttribute(n);if(!s)return{};let a;try{a=JSON.parse(s)}catch{throw new Error(`[DomTrigger] Invalid JSON in ${n}: ${s}`)}if(o){let u=y.get(e)??new Map;u.set(t,a),y.set(e,u)}return a}function k(e,t){let i=e.boundingClientRect,o=i.top+i.height/2,n=window.innerHeight/2;return Math.abs(o-n)<=t}var E=new Map,d={set(e,t){E.set(e,t)},get(e){return E.get(e)},delete(e){E.delete(e)},clear(){E.clear()}};var r="js-",v=`${r}load-`,T=`${r}viewin-`,A=`${r}viewout-`,I="view-center",S="view-ratio",R=new WeakMap,w={click:`${r}click-`,submit:`${r}submit-`,change:`${r}change-`,input:`${r}input-`,focusin:`${r}focusin-`,focusout:`${r}focusout-`,pointerdown:`${r}pointerdown-`,pointermove:`${r}pointermove-`,pointerup:`${r}pointerup-`,pointercancel:`${r}pointercancel-`,transitionend:`${r}transitionend-`,animationend:`${r}animationend-`,visibilitychange:`${r}visibilitychange-`,pageshow:`${r}pageshow-`,pagehide:`${r}pagehide-`,online:`${r}online-`,offline:`${r}offline-`,copy:`${r}copy-`,paste:`${r}paste-`,keydown:`${r}keydown-`,keyup:`${r}keyup-`,mouseover:`${r}mouseover-`,mouseout:`${r}mouseout-`},z=new Set(["visibilitychange","pageshow","pagehide","online","offline"]),M=Object.keys(w),O="prevent-default",V="stop-propagation",J=M.map(e=>`${e}-${O}`),q=M.map(e=>`${e}-${V}`),_=new Set,D=!1,K=new Set([I,S,...J,...q]);function B(e,t){if(!m(e))throw new Error(`[DomTrigger.use] Invalid trigger name: "${e}". Use kebab-case.`);if(K.has(e))throw new Error(`[DomTrigger.use] Reserved trigger name: "${e}".`);d.set(e,t)}async function Q(e,t){if(!m(e))throw new Error(`[DomTrigger.run] Invalid trigger name: "${e}". Use kebab-case.`);let i=d.get(e);i&&await i(t||{})}async function p(e,t,i){if(!m(e))throw new Error(`[DomTrigger.invoke] Invalid trigger name: "${e}". Use kebab-case.`);let o=d.get(e);if(!o)return;let n=P(t,e);await o({el:t,data:n,ctx:{name:e,event:i}})}async function N(){if(typeof document>"u")return;let e=Array.from(document.querySelectorAll(`[class^="${v}"], [class*=" ${v}"]`));for(let t of e){let i=g(t,v);for(let o of i)try{await p(o,t)}catch(n){console.error(`[DomTrigger.invokeLoad] Failed to invoke "${o}":`,t,n)}}}async function L(){if(typeof document>"u")return;let e=w.pageshow;if(!e)return;let t=document.body,i=g(t,e);for(let o of i)try{await p(o,t)}catch(n){console.error(`[DomTrigger.invokeShow] Failed to invoke "${o}":`,t,n)}}function Y(e){if(typeof document>"u"||_.has(e))return;_.add(e);let t=w[e];if(!t)return;(e==="online"||e==="offline"?window:document).addEventListener(e,n=>{if(e==="pointermove"&&!D)return;(e==="pointerup"||e==="pointercancel")&&(D=!1);let s=z.has(e)?document.body:n.target instanceof Element?n.target:null;if(!s)return;let a=s.closest(`[class^="${t}"], [class*=" ${t}"]`);if(!a)return;let u=a.getAttribute(`data-${e}-${O}`);u!==null&&u!=="false"&&n.preventDefault();let c=a.getAttribute(`data-${e}-${V}`);c!==null&&c!=="false"&&n.stopPropagation(),e==="pointerdown"&&(D=!0);let $=g(a,t);for(let b of $)p(b,a,n)})}function F(){for(let e of Object.keys(w))Y(e)}function C(){if(typeof document>"u"||typeof IntersectionObserver>"u")return;let e=new IntersectionObserver(o=>{for(let n of o){if(!(n.target instanceof Element))continue;let s=n.target,a=!1,u=s.getAttribute(`data-${I}`);if(u!==null){let c=u?parseInt(u,10):20,f=c>=0?c:20;a=k(n,f)}else{let c=s.getAttribute(`data-${S}`),f=c?parseFloat(c):0,$=f>=0&&f<=1?f:0;a=n.intersectionRatio>=$}let l=R.get(s);if(n.isIntersecting&&a){if(l==="in")continue;let c=g(s,T);for(let f of c)p(f,s);R.set(s,"in")}else{if(l!=="in")continue;let c=g(s,A);for(let f of c)p(f,s);R.set(s,"out")}}},{threshold:Array.from({length:11},(o,n)=>n/10)}),t=[`[class^="${T}"]`,`[class*=" ${T}"]`,`[class^="${A}"]`,`[class*=" ${A}"]`].join(", ");document.querySelectorAll(t).forEach(o=>e.observe(o))}function Z(e){d.delete(e)}function ee(){d.clear()}async function x(){await N(),await L(),F(),C()}async function te(){if(!(typeof document>"u")){document.readyState==="loading"&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",()=>e(),{once:!0})});try{await x()}catch(e){console.error("[DomTrigger.setupOnReady] Failed to setup:",e)}}}var ne={use:B,run:Q,invoke:p,invokeLoad:N,invokeShow:L,listen:F,observeView:C,unuse:Z,clear:ee,setup:x,setupOnReady:te},oe=ne;return j(re);})();
DomTrigger = DomTrigger.default || DomTrigger;
//# sourceMappingURL=dom-trigger.js.map
