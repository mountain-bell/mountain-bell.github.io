"use strict";var DomTrigger=(()=>{var w=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var G=(t,e)=>{for(var o in e)w(t,o,{get:e[o],enumerable:!0})},X=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of F(e))!U.call(t,i)&&i!==o&&w(t,i,{get:()=>e[i],enumerable:!(n=H(e,i))||n.enumerable});return t};var j=t=>X(w({},"__esModule",{value:!0}),t);var st={};G(st,{default:()=>it});function l(t){return/^[a-z][a-z0-9]*(?:-[a-z0-9]+)*$/.test(t)}function d(t,e){let o=[];return t.classList.forEach(n=>{if(!n.startsWith(e))return;let i=n.slice(e.length);l(i)&&o.push(i)}),o}var T=new WeakMap,f="uncache";function _(t,e){let o=`data-${f}-${e}`,n=!t.hasAttribute(o);if(n){let a=T.get(t)?.get(e);if(a)return a}let i=n?`data-${e}`:o,s=t.getAttribute(i);if(!s)return{};let u;try{u=JSON.parse(s)}catch{throw new Error(`[DomTrigger] Invalid JSON in ${i}: ${s}`)}if(n){let c=T.get(t)??new Map;c.set(e,u),T.set(t,c)}return u}function y(t,e){let o=t.boundingClientRect,n=o.top+o.height/2,i=window.innerHeight/2;return Math.abs(n-i)<=e}var E=new Map,g={set(t,e){E.set(t,e)},get(t){return E.get(t)},delete(t){E.delete(t)},clear(){E.clear()}};var r="js-",S={load:`${r}load-`,pageshow:`${r}pageshow-`,visibilitychange:`${r}visibilitychange-`,pagehide:`${r}pagehide-`,offline:`${r}offline-`,online:`${r}online-`,click:`${r}click-`,submit:`${r}submit-`,change:`${r}change-`,input:`${r}input-`,focusin:`${r}focusin-`,focusout:`${r}focusout-`,pointerdown:`${r}pointerdown-`,pointermove:`${r}pointermove-`,pointerup:`${r}pointerup-`,pointercancel:`${r}pointercancel-`,transitionend:`${r}transitionend-`,animationend:`${r}animationend-`,copy:`${r}copy-`,paste:`${r}paste-`,keydown:`${r}keydown-`,keyup:`${r}keyup-`,mouseover:`${r}mouseover-`,mouseout:`${r}mouseout-`},k=new Set(["load","pageshow","pagehide","offline","online"]),z=new Set(["visibilitychange",...k]),v=Object.keys(S),M="prevent-default",N="stop-propagation",J=v.map(t=>`${t}-${M}`),K=v.map(t=>`${t}-${N}`),I=new Set,$=!1,D=`${r}viewin-`,R=`${r}viewout-`,O="view-center",V="view-ratio",q=[`[class^="${D}"]`,`[class*=" ${D}"]`,`[class^="${R}"]`,`[class*=" ${R}"]`].join(", "),p=null,P=new WeakSet,h=new WeakMap,B=new Set([...J,...K,O,V,f]),Q=`${f}-`;function Y(t,e){if(!l(t))throw new Error(`[DomTrigger.use] Invalid trigger name: "${t}". Use kebab-case.`);if(B.has(t)||t.startsWith(Q))throw new Error(`[DomTrigger.use] Reserved trigger name: "${t}".`);g.set(t,e)}async function Z(t,e){if(!l(t))throw new Error(`[DomTrigger.run] Invalid trigger name: "${t}". Use kebab-case.`);let o=g.get(t);if(!o)return;let n=e?.el,i=e?.data,s=e?.event;await o({el:n,data:i,ctx:{name:t,source:"run",event:s}})}async function m(t,e,o){if(!l(t))throw new Error(`[DomTrigger.invoke] Invalid trigger name: "${t}". Use kebab-case.`);let n=g.get(t);if(!n)return;let i=_(e,t);await n({el:e,data:i,ctx:{name:t,source:"invoke",event:o}})}function tt(t){if(typeof document>"u"||I.has(t))return;I.add(t);let e=S[t];if(!e)return;(k.has(t)?window:document).addEventListener(t,n=>{if(t==="pointermove"&&!$)return;(t==="pointerup"||t==="pointercancel")&&($=!1);let i=z.has(t)?document.body:n.target instanceof Element?n.target:null;if(!i)return;let s=i.closest(`[class^="${e}"], [class*=" ${e}"]`);if(!s)return;let u=s.getAttribute(`data-${t}-${M}`);u!==null&&u!=="false"&&n.preventDefault();let a=s.getAttribute(`data-${t}-${N}`);a!==null&&a!=="false"&&n.stopPropagation(),t==="pointerdown"&&($=!0);let b=d(s,e);for(let x of b)m(x,s,n)})}function C(){for(let t of v)tt(t)}function L(){if(typeof document>"u"||typeof IntersectionObserver>"u")return;p||(p=new IntersectionObserver(e=>{for(let o of e){if(!(o.target instanceof Element))continue;let n=o.target,i=!1,s=n.getAttribute(`data-${O}`);if(s!==null){let c=s?parseInt(s,10):20,a=c>=0?c:20;i=y(o,a)}else{let c=n.getAttribute(`data-${V}`),a=c?parseFloat(c):0,A=a>=0&&a<=1?a:0;i=o.intersectionRatio>=A}let u=h.get(n);if(o.isIntersecting&&i){if(u==="in")continue;let c=d(n,D);for(let a of c)m(a,n);h.set(n,"in")}else{if(u!=="in")continue;let c=d(n,R);for(let a of c)m(a,n);h.set(n,"out")}}},{threshold:Array.from({length:11},(e,o)=>o/10)})),document.querySelectorAll(q).forEach(e=>{p&&!P.has(e)&&(p.observe(e),P.add(e))})}function et(t){g.delete(t)}function nt(){g.clear()}function W(){C(),L()}function ot(){if(typeof document>"u")return;let t=()=>{try{W()}catch(e){console.error("[DomTrigger.setupOnReady] Failed to setup:",e)}};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",t,{once:!0});return}t()}var rt={use:Y,run:Z,invoke:m,listen:C,observeView:L,unuse:et,clear:nt,setup:W,setupOnReady:ot},it=rt;return j(st);})();
DomTrigger = DomTrigger.default || DomTrigger;
//# sourceMappingURL=dom-trigger.js.map
