/*! MIT License | Copyright (c) 2025 mountain-bell */
"use strict";var DomTrigger=(()=>{var D=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0})},Y=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of q(t))!B.call(e,i)&&i!==r&&D(e,i,{get:()=>t[i],enumerable:!(n=K(t,i))||n.enumerable});return e};var Z=e=>Y(D({},"__esModule",{value:!0}),e);var ue={};Q(ue,{clear:()=>z,default:()=>ce,invoke:()=>p,listen:()=>_,observeView:()=>k,run:()=>C,setup:()=>P,setupOnReady:()=>J,unuse:()=>X,use:()=>G});function l(e,t,r){if(typeof e!==t)throw new TypeError(r)}function S(e,t){if(typeof e!="object"||e===null)throw new TypeError(t)}function O(e,t){if(!(e instanceof Element))throw new TypeError(t)}function M(e,t){if(!(e instanceof Event))throw new TypeError(t)}function d(e){return/^[a-z][a-z0-9]*(?:-[a-z0-9]+)*$/.test(e)}function N(e,t){let r=[],n=e;for(;n;)n.matches(`[class^="${t}"], [class*=" ${t}"]`)&&r.push(n),n=n.parentElement;return r}function T(e,t){let r=[];return e.classList.forEach(n=>{if(!n.startsWith(t))return;let i=n.slice(t.length);d(i)&&r.push(i)}),r}var $=new WeakMap,h="uncache";function V(e,t){let r=`data-${h}-${t}`,n=!e.hasAttribute(r);if(n){let g=$.get(e)?.get(t);if(g)return g}let i=n?`data-${t}`:r,s=e.getAttribute(i);if(!s)return{};let c;try{c=JSON.parse(s)}catch{throw new Error(`[DomTrigger] Invalid JSON in ${i}: ${s}`)}if(n){let a=$.get(e)??new Map;a.set(t,c),$.set(e,a)}return c}var w=new Map,f={set(e,t){w.set(e,t)},get(e){return w.get(e)},delete(e){w.delete(e)},clear(){w.clear()}};var o="js-",W={load:`${o}load-`,pageshow:`${o}pageshow-`,visibilitychange:`${o}visibilitychange-`,pagehide:`${o}pagehide-`,offline:`${o}offline-`,online:`${o}online-`,click:`${o}click-`,submit:`${o}submit-`,change:`${o}change-`,input:`${o}input-`,focusin:`${o}focusin-`,focusout:`${o}focusout-`,pointerdown:`${o}pointerdown-`,pointermove:`${o}pointermove-`,pointerup:`${o}pointerup-`,pointercancel:`${o}pointercancel-`,transitionend:`${o}transitionend-`,animationend:`${o}animationend-`,copy:`${o}copy-`,paste:`${o}paste-`,keydown:`${o}keydown-`,keyup:`${o}keyup-`,mouseover:`${o}mouseover-`,mouseout:`${o}mouseout-`},H=new Set(["load","pageshow","pagehide","offline","online"]),ee=new Set(["visibilitychange",...H]),A=Object.keys(W),F="prevent-default",U="stop-propagation",te=A.map(e=>`${e}-${F}`),ne=A.map(e=>`${e}-${U}`),x=new Set,b=!1,y=`${o}viewin-`,I=`${o}viewout-`,j="view-ratio",re=[`[class^="${y}"]`,`[class*=" ${y}"]`,`[class^="${I}"]`,`[class*=" ${I}"]`].join(", "),v=null,L=new WeakSet,R=new WeakMap,oe=new Set([...te,...ne,j,h]),ie=`${h}-`;function G(e,t){if(l(e,"string","[DomTrigger.use] Invalid argument: the first parameter must be a string."),l(t,"function","[DomTrigger.use] Invalid argument: the second parameter must be a function."),!d(e))throw new Error(`[DomTrigger.use] Invalid trigger name: "${e}". Use kebab-case.`);if(oe.has(e)||e.startsWith(ie))throw new Error(`[DomTrigger.use] Reserved trigger name: "${e}".`);f.set(e,t)}async function C(e,t){if(l(e,"string","[DomTrigger.run] Invalid argument: the first parameter must be a string."),t!==void 0&&S(t,"[DomTrigger.run] Invalid argument: the second parameter must be an object when provided."),!d(e))throw new Error(`[DomTrigger.run] Invalid trigger name: "${e}". Use kebab-case.`);let r=f.get(e);if(!r)return;let n=t?.el,i=t?.data,s=t?.event;await r({el:n,data:i,ctx:{name:e,source:"run",event:s}})}async function p(e,t,r){if(l(e,"string","[DomTrigger.invoke] Invalid argument: the first parameter must be a string."),O(t,"[DomTrigger.invoke] Invalid argument: the second parameter must be an Element."),r!==void 0&&M(r,"[DomTrigger.invoke] Invalid argument: the third parameter must be an Event when provided."),!d(e))throw new Error(`[DomTrigger.invoke] Invalid trigger name: "${e}". Use kebab-case.`);let n=f.get(e);if(!n)return;let i=V(t,e);await n({el:t,data:i,ctx:{name:e,source:"invoke",event:r}})}function se(e){if(typeof document>"u"||x.has(e))return;x.add(e);let t=W[e];if(!t)return;(H.has(e)?window:document).addEventListener(e,n=>{if(e==="pointermove"&&!b)return;(e==="pointerup"||e==="pointercancel")&&(b=!1);let i=ee.has(e)?document.body:n.target instanceof Element?n.target:null;if(!i)return;let s=N(i,t);if(s.length===0)return;e==="pointerdown"&&(b=!0);let c=!1;for(let a of s){if(!c){let u=a.getAttribute(`data-${e}-${F}`);u!==null&&u!=="false"&&(n.preventDefault(),c=!0)}let g=a.getAttribute(`data-${e}-${U}`),E=g!==null&&g!=="false",m=T(a,t);for(let u of m)p(u,a,n);if(E){n.stopImmediatePropagation();break}}})}function _(){for(let e of A)se(e)}function k(){if(typeof document>"u"||typeof IntersectionObserver>"u")return;v||(v=new IntersectionObserver(t=>{for(let r of t){if(!(r.target instanceof Element))continue;let n=r.target,i=n.getAttribute(`data-${j}`),s=i?parseFloat(i):0,c=s>=0&&s<=1?s:0,a=r.intersectionRatio,g=r.isIntersecting&&a>=c,E=R.get(n);if(g){if(E==="in")continue;let m=T(n,y);for(let u of m)p(u,n);R.set(n,"in")}else{if(E!=="in")continue;let m=T(n,I);for(let u of m)p(u,n);R.set(n,"out")}}},{threshold:Array.from({length:11},(t,r)=>r/10)})),document.querySelectorAll(re).forEach(t=>{v&&!L.has(t)&&(v.observe(t),L.add(t))})}function X(e){if(l(e,"string","[DomTrigger.unuse] Invalid argument: the first parameter must be a string."),!d(e))throw new Error(`[DomTrigger.unuse] Invalid trigger name: "${e}". Use kebab-case.`);f.delete(e)}function z(){f.clear()}function P(){_(),k()}function J(e){if(e!==void 0&&l(e,"function","[DomTrigger.setupOnReady] Invalid argument: the first parameter must be a function when provided."),typeof document>"u")return;let t=()=>{try{P()}catch(r){console.error("[DomTrigger.setupOnReady] Failed to setup:",r)}e?.()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",t,{once:!0});return}t()}var ae={use:G,run:C,invoke:p,listen:_,observeView:k,unuse:X,clear:z,setup:P,setupOnReady:J};var ce=ae;return Z(ue);})();
DomTrigger = DomTrigger.default || DomTrigger;
//# sourceMappingURL=dom-trigger.js.map
