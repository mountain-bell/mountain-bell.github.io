"use strict";var DomTrigger=(()=>{var w=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var r in t)w(e,r,{get:t[r],enumerable:!0})},j=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of U(t))!G.call(e,i)&&i!==r&&w(e,i,{get:()=>t[i],enumerable:!(n=F(t,i))||n.enumerable});return e};var z=e=>j(w({},"__esModule",{value:!0}),e);var ae={};X(ae,{default:()=>se});function g(e){return/^[a-z][a-z0-9]*(?:-[a-z0-9]+)*$/.test(e)}function y(e,t){let r=[],n=e;for(;n;)n.matches(`[class^="${t}"], [class*=" ${t}"]`)&&r.push(n),n=n.parentElement;return r}function d(e,t){let r=[];return e.classList.forEach(n=>{if(!n.startsWith(t))return;let i=n.slice(t.length);g(i)&&r.push(i)}),r}var $=new WeakMap,E="uncache";function I(e,t){let r=`data-${E}-${t}`,n=!e.hasAttribute(r);if(n){let a=$.get(e)?.get(t);if(a)return a}let i=n?`data-${t}`:r,c=e.getAttribute(i);if(!c)return{};let u;try{u=JSON.parse(c)}catch{throw new Error(`[DomTrigger] Invalid JSON in ${i}: ${c}`)}if(n){let s=$.get(e)??new Map;s.set(t,u),$.set(e,s)}return u}function P(e,t){let r=e.boundingClientRect,n=r.top+r.height/2,i=window.innerHeight/2;return Math.abs(n-i)<=t}var p=new Map,l={set(e,t){p.set(e,t)},get(e){return p.get(e)},delete(e){p.delete(e)},clear(){p.clear()}};var o="js-",M={load:`${o}load-`,pageshow:`${o}pageshow-`,visibilitychange:`${o}visibilitychange-`,pagehide:`${o}pagehide-`,offline:`${o}offline-`,online:`${o}online-`,click:`${o}click-`,submit:`${o}submit-`,change:`${o}change-`,input:`${o}input-`,focusin:`${o}focusin-`,focusout:`${o}focusout-`,pointerdown:`${o}pointerdown-`,pointermove:`${o}pointermove-`,pointerup:`${o}pointerup-`,pointercancel:`${o}pointercancel-`,transitionend:`${o}transitionend-`,animationend:`${o}animationend-`,copy:`${o}copy-`,paste:`${o}paste-`,keydown:`${o}keydown-`,keyup:`${o}keyup-`,mouseover:`${o}mouseover-`,mouseout:`${o}mouseout-`},N=new Set(["load","pageshow","pagehide","offline","online"]),J=new Set(["visibilitychange",...N]),b=Object.keys(M),O="prevent-default",V="stop-propagation",K=b.map(e=>`${e}-${O}`),q=b.map(e=>`${e}-${V}`),S=new Set,D=!1,v=`${o}viewin-`,A=`${o}viewout-`,C="view-center",L="view-ratio",B=[`[class^="${v}"]`,`[class*=" ${v}"]`,`[class^="${A}"]`,`[class*=" ${A}"]`].join(", "),m=null,k=new WeakSet,R=new WeakMap,Q=new Set([...K,...q,C,L,E]),Y=`${E}-`;function Z(e,t){if(!g(e))throw new Error(`[DomTrigger.use] Invalid trigger name: "${e}". Use kebab-case.`);if(Q.has(e)||e.startsWith(Y))throw new Error(`[DomTrigger.use] Reserved trigger name: "${e}".`);l.set(e,t)}async function ee(e,t){if(!g(e))throw new Error(`[DomTrigger.run] Invalid trigger name: "${e}". Use kebab-case.`);let r=l.get(e);if(!r)return;let n=t?.el,i=t?.data,c=t?.event;await r({el:n,data:i,ctx:{name:e,source:"run",event:c}})}async function T(e,t,r){if(!g(e))throw new Error(`[DomTrigger.invoke] Invalid trigger name: "${e}". Use kebab-case.`);let n=l.get(e);if(!n)return;let i=I(t,e);await n({el:t,data:i,ctx:{name:e,source:"invoke",event:r}})}function te(e){if(typeof document>"u"||S.has(e))return;S.add(e);let t=M[e];if(!t)return;(N.has(e)?window:document).addEventListener(e,n=>{if(e==="pointermove"&&!D)return;(e==="pointerup"||e==="pointercancel")&&(D=!1);let i=J.has(e)?document.body:n.target instanceof Element?n.target:null;if(!i)return;let c=y(i,t);if(c.length===0)return;e==="pointerdown"&&(D=!0);let u=!1;for(let s of c){if(!u){let f=s.getAttribute(`data-${e}-${O}`);f!==null&&f!=="false"&&(n.preventDefault(),u=!0)}let a=s.getAttribute(`data-${e}-${V}`),h=a!==null&&a!=="false",_=d(s,t);for(let f of _)T(f,s,n);if(h){n.stopImmediatePropagation();break}}})}function W(){for(let e of b)te(e)}function x(){if(typeof document>"u"||typeof IntersectionObserver>"u")return;m||(m=new IntersectionObserver(t=>{for(let r of t){if(!(r.target instanceof Element))continue;let n=r.target,i=!1,c=n.getAttribute(`data-${C}`);if(c!==null){let s=c?parseInt(c,10):20,a=s>=0?s:20;i=P(r,a)}else{let s=n.getAttribute(`data-${L}`),a=s?parseFloat(s):0,h=a>=0&&a<=1?a:0;i=r.intersectionRatio>=h}let u=R.get(n);if(r.isIntersecting&&i){if(u==="in")continue;let s=d(n,v);for(let a of s)T(a,n);R.set(n,"in")}else{if(u!=="in")continue;let s=d(n,A);for(let a of s)T(a,n);R.set(n,"out")}}},{threshold:Array.from({length:11},(t,r)=>r/10)})),document.querySelectorAll(B).forEach(t=>{m&&!k.has(t)&&(m.observe(t),k.add(t))})}function ne(e){l.delete(e)}function re(){l.clear()}function H(){W(),x()}function oe(e){if(typeof document>"u")return;let t=()=>{try{H()}catch(r){console.error("[DomTrigger.setupOnReady] Failed to setup:",r)}typeof e=="function"&&e()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",t,{once:!0});return}t()}var ie={use:Z,run:ee,invoke:T,listen:W,observeView:x,unuse:ne,clear:re,setup:H,setupOnReady:oe},se=ie;return z(ae);})();
DomTrigger = DomTrigger.default || DomTrigger;
//# sourceMappingURL=dom-trigger.js.map
